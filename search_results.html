<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wyniki wyszukiwania - PogodnyWieczorek</title>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/all_styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

  <!-- Nawigacja -->
  <div id="navigation-placeholder"></div>

  <!-- Sekcja nagłówka -->
  <section id="about" class="page-section background-image-section search-results-bg">
    <div class="container text-center">
      <h2 class="section-heading text-uppercase">Wyniki wyszukiwania</h2>
      <p class="text-muted">Zobacz, co znaleźliśmy dla Ciebie</p>
    </div>
  </section>

  <!-- Menu -->
  <div id="menu-placeholder"></div>

  <!-- Wyniki wyszukiwania -->
  <div class="container my-5">
    <h3 id="search-title" class="mb-4"></h3>
    <div id="results" class="row"></div>
  </div>

  <!-- Stopka -->
  <div id="footer-placeholder"></div>

  <!-- Modal -->
  <div id="game-modal-placeholder"></div>

  <!-- Skrypty -->

      <!-- Skrypty -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>



  <!-- Wczytywanie partiali -->

<script>
document.addEventListener("DOMContentLoaded", function() {
    const loadPartial = (id, url) => {
        return fetch(url)
            .then(res => res.text())
            .then(data => { document.getElementById(id).innerHTML = data; })
            .catch(err => console.error(`Błąd wczytywania ${url}:`, err));
    };

    Promise.all([
        loadPartial('navigation-placeholder', 'partials/navigation.html'),
        loadPartial('menu-placeholder', 'partials/menu.html'),
        loadPartial('footer-placeholder', 'partials/footer.html'),
        loadPartial('game-modal-placeholder', 'partials/gameModal.html')
    ]).then(() => {
        const script = document.createElement("script");
        script.src = "js/modal.js";
        document.body.appendChild(script);
    });
});
</script>


  <!-- Wczytywanie wyników wyszukiwania -->
  <script>
  document.addEventListener("DOMContentLoaded", function() {
      const params = new URLSearchParams(window.location.search);
      const query = params.get("query")?.trim().toLowerCase() || "";
      const resultsContainer = document.getElementById("results");
      const titleElement = document.getElementById("search-title");

      titleElement.textContent = query ? `Wyniki wyszukiwania dla: "${query}"` : "Wszystkie gry";

      fetch("games/games.json")
          .then(res => res.json())
          .then(games => {
              const filtered = query
                  ? games.filter(g => 
                      g.title?.toLowerCase().includes(query) || 
                      g.description?.toLowerCase().includes(query))
                  : games;

              if (filtered.length === 0) {
                  resultsContainer.innerHTML = "<p class='text-center'>Brak wyników dla podanego zapytania.</p>";
                  return;
              }

              let html = '<div class="row">';
              filtered.forEach(game => {
                  html += `
                      <div class="col-md-4 mb-4">
                          <div class="card h-100">
                              <img src="${game.image}" class="card-img-top" alt="${game.title}" style="height:200px; object-fit:cover;">
                              <div class="card-body d-flex flex-column">
                                  <h5 class="card-title">${game.title}</h5>
                                  <p class="card-text">${(game.description || '').substring(0,150)}...</p>
                                  <p class="card-text"><strong>Kategorie:</strong> ${(game.categories || []).join(', ')}</p>
                                  <button 
                                      class="btn btn-sm btn-outline-secondary mt-auto read-more"
                                      data-title="${game.title}"
                                      data-description="${game.description}"
                                      data-image="${game.image}"
                                      data-equipment="${game.equipment || ''}"
                                      data-variety="${game.variety || ''}"
                                      data-comment="${game.comment || ''}"
                                      data-categories="${(game.categories || []).join(', ')}">
                                      Czytaj dalej
                                  </button>
                              </div>
                          </div>
                      </div>
                  `;
              });
              html += '</div>';
              resultsContainer.innerHTML = html;
          })
          .catch(err => console.error("Błąd wczytywania gier:", err));
  });
  </script>

  <script>
document.addEventListener("DOMContentLoaded", function() {

  // Jeśli wolisz ładować partiale asynchronicznie z Promise.all, rób to wcześniej.
  // Poniższy handler działa niezależnie (delegacja + nearest ancestor).

  document.addEventListener('click', function(event) {
    const button = event.target.closest('.read-more');
    if (!button) return; // nie kliknięto przycisku read-more

    console.log('Kliknięto Czytaj dalej dla:', button.dataset.title);

    // Sprawdź, czy modal jest w DOM
    const modalEl = document.getElementById('gameModal');
    if (!modalEl) {
      console.error('Nie znaleziono #gameModal w DOM. Upewnij się, że partial gameModal.html jest wczytany.');
      return;
    }

    // Użyj jQuery jeśli dostępne
    if (typeof $ === 'undefined' || !$.fn || !$.fn.modal) {
      console.error('jQuery lub Bootstrap modal plugin nie są dostępne.');
      return;
    }

    const $modal = $('#gameModal');

    // Wstaw dane (zabezpieczone, .text() dla zwykłego tekstu, .html() dla HTML jeśli potrzebujesz)
    $modal.find('#modal-title').text(button.dataset.title || '');
    $modal.find('#modal-image').attr('src', button.dataset.image || '').attr('alt', button.dataset.title || '');
    $modal.find('#modal-description').html(button.dataset.description || '');
    $modal.find('#modal-equipment').text(button.dataset.equipment || '');

    // Variety
    if (button.dataset.variety && button.dataset.variety.trim() !== '' && button.dataset.variety !== 'null') {
      $modal.find('#modal-variety-row').show();
      $modal.find('#modal-variety').html(button.dataset.variety);
    } else {
      $modal.find('#modal-variety-row').hide();
    }

    // Comment
    if (button.dataset.comment && button.dataset.comment.trim() !== '' && button.dataset.comment !== 'null') {
      $modal.find('#modal-comment-row').show();
      $modal.find('#modal-comment').html(button.dataset.comment);
    } else {
      $modal.find('#modal-comment-row').hide();
    }

    // Styl modal-body
    $modal.find('.modal-body').css({
      'max-height': '80vh',
      'overflow-y': 'auto'
    });

    // Reset scroll to top on shown
    $modal.off('shown.bs.modal').on('shown.bs.modal', function () {
      $(this).find('.modal-body').scrollTop(0);
    });

    // Pokaż modal
    $modal.modal('show');
  });

});
</script>



</body>
</html>
